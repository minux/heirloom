Special features for PDF output
===============================

The basics
----------

Heirloom troff cannot directly generate PDF documents; the dpost
post-processor generates PostScript which can be passed to a distiller
utility such as Ghostscript's "ps2pdf". But it is possible to include
special advices to the distiller using a PostScript operator called
"pdfmark", and dpost provides an interface to generate such advices
conveniently from troff source code with the "\X'PDFMark ...'" escape
sequence.


Preparation: Setting the correct paper format
---------------------------------------------

When generating PDF files, it is especially important to set a correct
media size. While the ".papersize" troff request takes care of correct
positioning of data on the output page, it does not include an advice
to the distiller about the actual media size. The most convenient way
to do this are ps2pdf command line arguments. For example, if you want
to create an A4 document, use ".papersize a4" in troff combined with
"ps2pdf -sPAPERSIZE=a4". To create a document with a custom media size,
use e.g. ".papersize 298p 482p" and "ps2pdf -dDEVICEWIDTHPOINTS=298
-dDEVICEHEIGHTPOINTS=482".


Specifying document description items
-------------------------------------

PDF documents can include meta-data about author, title etc. To generate
such data, use the "PDFMark" device command of dpost with the troff "\X"
command, e.g.

	\X'PDFMark: Author My Name'
	\X'PDFMark: Keywords Typesetting, PDF documents'
	\X'PDFMark: Subject troff, dpost, and pdfmark'
	\X'PDFMark: Title Special features for PDF output'

Note that whitespace and newlines surrounding \X escape sequences are
considered to be input text by troff. To avoid inserting superfluous
spaces or line breaks, specify this information before the initial
".sp |\n[topmargin]u" request or the like in your document.


Creating bookmarks
------------------

Bookmarks are usually shown by the PDF viewer at the left of the
window. When you create PDF files longer than a few pages for viewing
on the screen, you should include bookmarks for each chapter or section
because they enable the reader to navigate much more conveniently.

Start with a bookmark for the title page. "0" is the level of the
bookmark in the tree structure, and the following arguments form the
name of the bookmark:

	\X'PDFMark: Bookmark 0 Title'

Similar to the description specifications above, this bookmark should
appear before the top margin of the title page.

When generating bookmarks for chapters and sections, it is usually most
practical to include the command in the chapter/section macros, as e.g.

	.de CH
	.	bp
	\\X'PDFMark: Bookmark 0 \\$1'
	.	sp |\n[topmargin]u
	.	ce
	.	sp
	..
	.de SH
	.	ce
	\\$1\\v'-1v'\\X'PDFMark: Bookmark 1 \\$1'
	.	sp
	..

Unless the bookmark command occurs at the top of the page, it refers
to the baseline of the text; this is why a "\v'-1v'" command occurs
before it in the section macro. Also do not forget to use "\\X" inside
a macro.

The level of the first bookmark in a document must be of level 0. The
levels of following bookmarks must be either

- one higher than the level of the previous bookmark. The new bookmark
  then becomes a child of the previous bookmark.

- equal to the level of the previous bookmark. In this case, both
  bookmarks are grouped below the first previous bookmark of the first
  higher level, or at the top level for level 0.

- lower than the level of the previous bookmark. This terminates the
  list of children of the higher levels.

As an example, the following level structure is legal, and causes the
PDF viewer to group the bookmarks as shown:

  0		title page
  0		Chapter 1
  +--1		Section 1.1
  +--1		Section 1.2
  |  +--2	Subsection 1.2.1
  |  +--2	Subsection 1.2.2
  |  +--2	Subsection 1.2.3
  +--1		Section 1.3
     +--2	Subsection 1.3.1
     +--2	Subsection 1.3.2
  0		Chapter 2
  +--1		Section 2.1
  0		Index

In case of an illegal structure in which the level of a bookmark is
raised by more than one above its predecessor, dpost emits a warning
and assigns the highest legal level. However, a garbled document
structure may result:

  0
  +--2		<== the first level 2 is corrected to 1 by dpost
     +--2	    so the second becomes a child of the first

Thus such dpost warnings should usually be taken seriously, and the
document should be corrected.

An alternate form of bookmarks, \X'PDFMark: BookmarkClosed ...', is
available. The syntax is the same, but the initial view in the tree
structure is collapsed, i.e. no children are shown by default. It the
bookmark has no children, there is no difference to a regular bookmark.

If all of the bookmarks in a document appear at the same wrong vertical
position, this is usually a sign that the media size of troff/dpost did
not match that of the distiller (see above).


Gunnar Ritter                                                 9/10/05
